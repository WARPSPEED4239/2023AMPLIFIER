
package frc.robot.commands;

import edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;
import edu.wpi.first.wpilibj2.command.CommandBase;
import frc.robot.subsystems.Drivetrain;
import frc.robot.subsystems.DrivetrainShifter;

public class AutoBalance extends CommandBase {

  private final Drivetrain mDrivetrain;
  private final DrivetrainShifter mDrivetrainShifter;
  double pitch = 0.0;
  double speed = 0.0;
  double startingYaw = 0.0;
  boolean ascend = true;

  public AutoBalance(Drivetrain drivetrain, DrivetrainShifter shifter) {
    mDrivetrain = drivetrain;
    mDrivetrainShifter = shifter;
    addRequirements(mDrivetrain, mDrivetrainShifter);
  }

  @Override
  public void initialize() {
    startingYaw = mDrivetrain.getYaw();
    mDrivetrainShifter.setPistonState(true);
  }

  
  @Override
  public void execute() {
    pitch = mDrivetrain.getRoll();

    if (ascend) {
      if (pitch > -12 && pitch < 12) {
        mDrivetrain.DriveStraightWithGyro(1.0, startingYaw);
      } else {
        ascend = false;
      }

    } else {
      if (pitch > 0.0) {
        speed = 0.00269 * Math.pow(pitch, 2);
      } else if (pitch < 0.0) {
        speed = -0.00269 * Math.pow(pitch, 2);
      }

      if(pitch > -3.1 && pitch < 3.1) {
        mDrivetrain.stopDrivetrainMotors();
      } else {
        mDrivetrain.DriveStraightWithGyro(speed, startingYaw);
      }

      SmartDashboard.putNumber("Auto Balance Speed", speed);
    }
  }



  @Override
  public void end(boolean interrupted) {}

 
  @Override
  public boolean isFinished() {
    return false;
  }
}
